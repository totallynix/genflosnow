<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>GAHOOT by nix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        padding: 24px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #050816;
        color: #e5e7eb;
      }
      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      h1 {
        font-size: 28px;
        margin: 0;
      }
      .admin-link {
        font-size: 14px;
        color: #9ca3af;
        text-decoration: none;
        border: 1px solid #1f2937;
        padding: 6px 10px;
        border-radius: 999px;
      }
      .admin-link:hover {
        text-decoration: underline;
        border-color: #3b82f6;
      }
      #subtitle {
        font-size: 14px;
        color: #9ca3af;
        margin-bottom: 20px;
      }
      #quiz-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
      }
      .quiz-card {
        background: #111827;
        border-radius: 10px;
        border: 1px solid #1f2937;
        padding: 16px;
        transition: transform 0.1s ease, box-shadow 0.1s ease,
          border-color 0.1s ease;
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .quiz-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);
        border-color: #3b82f6;
      }
      .quiz-card-closed {
        cursor: default;
        pointer-events: none;
        opacity: 0.85;
      }
      .quiz-title {
        font-size: 18px;
        margin-bottom: 6px;
      }
      .quiz-meta {
        font-size: 13px;
        color: #9ca3af;
        margin-bottom: 8px;
      }
      .quiz-status {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .status-open {
        background: rgba(22, 163, 74, 0.18);
        color: #4ade80;
      }
      .status-closed {
        background: rgba(148, 163, 184, 0.18);
        color: #e5e7eb;
      }
      #status {
        margin-top: 12px;
        font-size: 13px;
        color: #9ca3af;
      }
    </style>
  </head>
  <body>
    <div class="top-bar">
      <h1>GAHOOT by nix</h1>
      <a href="/admin/" class="admin-link">Admin</a>
    </div>

    <div id="subtitle">
      Budget Kahoot. Pick a quiz to get started. Faster correct answers and
      higher streaks earn more points. Coded with the aid of Perplexity Comet.
    </div>

    <div id="quiz-list"></div>
    <div id="status"></div>

    <script>
      async function loadQuizzes() {
        const listEl = document.getElementById("quiz-list");
        const statusEl = document.getElementById("status");

        statusEl.textContent = "Loading quizzes…";

        try {
          const res = await fetch("/api/quizzes", { cache: "no-store" });
          if (!res.ok) throw new Error("HTTP " + res.status);

          const payload = await res.json();
          const quizzes = payload.quizzes || [];

          if (quizzes.length === 0) {
            listEl.innerHTML = "<p>No quizzes available yet.</p>";
            statusEl.textContent = "";
            return;
          }

          listEl.innerHTML = "";
          for (const q of quizzes) {
            const a = document.createElement("a");
            a.className = "quiz-card";

            if (q.isOpen) {
              a.href = "/quiz/?id=" + encodeURIComponent(q.id);
            } else {
              a.classList.add("quiz-card-closed");
            }

            const statusSpan = document.createElement("span");
            statusSpan.className =
              "quiz-status " + (q.isOpen ? "status-open" : "status-closed");
            statusSpan.textContent = q.isOpen ? "Open" : "Closed";

            const perQuestion = q.timeLimitSeconds || "?";
            a.innerHTML = `
              <div>
                <div class="quiz-title">${q.title}</div>
                <div class="quiz-meta">
                  ${q.questionCount ?? "?"} question(s) • ${perQuestion} s / question
                </div>
              </div>
            `;
            a.appendChild(statusSpan);

            listEl.appendChild(a);
          }

          statusEl.textContent = "";
        } catch (err) {
          console.error(err);
          statusEl.textContent = "Failed to load quizzes.";
        }
      }

      loadQuizzes();
    </script>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"006eebff4055446c95b8663a9756b495","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
